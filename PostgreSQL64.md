# Домашнее задание к занятию "6.4. PostgreSQL"

## Задача 1

- Используя docker поднимите инстанс PostgreSQL (версию 13). Данные БД сохраните в volume.
![img_22.png](img_22.png)
![img_23.png](img_23.png)

- Подключитесь к БД PostgreSQL используя psql.
Воспользуйтесь командой \? для вывода подсказки по имеющимся в psql управляющим командам.
Найдите и приведите управляющие команды для:
вывода списка БД
![img_24.png](img_24.png)

- подключения к БД
- вывода списка таблиц

  ![img_25.png](img_25.png)

- вывода описания содержимого таблиц
- выхода из psql

  ![img_21.png](img_21.png)

## Задача 2

- Используя psql создайте БД test_database.

  ![img_26.png](img_26.png)

- Изучите бэкап БД.
- Восстановите бэкап БД в test_database.

  ![img_27.png](img_27.png)

- Перейдите в управляющую консоль psql внутри контейнера.
- Подключитесь к восстановленной БД и проведите операцию ANALYZE для сбора статистики по таблице.
- Используя таблицу pg_stats, найдите столбец таблицы orders с наибольшим средним значением размера элементов в байтах.
- Приведите в ответе команду, которую вы использовали для вычисления и полученный результат.

  ![img_28.png](img_28.png)


## Задача 3
Архитектор и администратор БД выяснили, что ваша таблица orders разрослась до невиданных размеров и поиск по ней занимает долгое время. Вам, как успешному выпускнику курсов DevOps в нетологии предложили провести разбиение таблицы на 2 (шардировать на orders_1 - price>499 и orders_2 - price<=499).

Предложите SQL-транзакцию для проведения данной операции.

**Преобразуем существующую таблицу в партиционированную для этого пересоздадим таблицу.**

  ![img_29.png](img_29.png)

- Можно ли было изначально исключить "ручное" разбиение при проектировании таблицы orders?

При проектировании таблицы можно было сделать ее секционированной, тем самым мы бы избежали переименования исходной таблицы и переноса данных в новую.

## Задача 4

- Используя утилиту pg_dump создайте бекап БД test_database.

  ![img_30.png](img_30.png)

- Как бы вы доработали бэкап-файл, чтобы добавить уникальность значения столбца title для таблиц test_database?

```
Добавил бы индекс. CREATE INDEX ON orders ((lower(title)));
```